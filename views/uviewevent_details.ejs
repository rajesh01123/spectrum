<%- include ("uheader.ejs") %>
<%- include ("unavbar.ejs") %>

      <!-- Main Content -->
      <div class="main-content">
        

        <section class="section product-detail">
            <div class="container">
              <!-- Page Header -->
              <div class="row mb-4">
                <div class="col text-center">
                  <h2 class="page-title"><i class="fa fa-th-large" aria-hidden="true"></i> Event Details</h2>
                </div>
              </div>
          
              <!-- Product Detail Card -->
              <div class="row" style="border: 2px solid #000;border-radius: 5px;">
                <div class="col-md-6">
                  <!-- Product Image -->
                  <div class="product-image">
                    <img src="/uploads/<%- event_data[0].image %>" alt="Event Image" class="img-fluid rounded shadow-sm">
                  </div>
                </div>
                <div class="col-md-6"><br/>
                  <!-- Product Info -->
                  <div class="product-info">
                    <h3 class="product-title"><%- event_data[0].title %></h3>
                    <p class="product-description"><%- event_data[0].description %></p>
                    
                    <!-- Product Details -->
                     <!--  -->
                    <%  //console.log('end time ', event_data[0].end_time) %>
                     

                    <ul class="list-group mb-3">
                      <li class="list-group-item"><strong>Name:</strong> <%- event_data[0].venue_name %></li>
                      <li class="list-group-item"><strong>Participants:</strong> <%- event_data[0].participants %></li>
                      <li class="list-group-item"><strong> Date:</strong> <%- event_data[0].date %></li>
                      <li class="list-group-item"><strong>Start Time:</strong> <%- event_data[0].start_time %></li>
                      <li class="list-group-item"><strong> End_time:</strong> <%- event_data[0].end_time %></li>
                      <li class="list-group-item"><strong> Participants price:</strong> <%- event_data[0].price %></li>
                      <!-- <li class="list-group-item"><strong> Start Date:</strong> <%- //event_data[0].start_time %></li> -->
                      <li class="list-group-item"><strong>Location:</strong> <%- event_data[0].venue_location %></li>
                     

                     
                    </ul>
          
                   
                    <div class="product-actions">
                      <input type="hidden" name="event_type" id="event_type" value="<%- event_data[0].event_type %>">
                      <input type="hidden" name="event_name" id="event_name" value="<%- event_data[0].title %>">
                      <input type="hidden" name="event_name" id="event_id" value="<%- event_data[0].id %>">
                      
                      <input type="hidden" name="price" id="ammount" value="<%- event_data[0].price %>">
                      <input type="submit" name="submit" id="pay-btn" value="pay" class="btn btn-primary btn-lg mb-2">
                    
                      <a href="/events" class="btn btn-secondary btn-lg"><i class="fa fa-arrow-left"></i> Back to Events</a>
                    </div>
                  </div>
                </div><hr style="border:1px solid #000;width: 100%;">
                
                <!-- Additional Information -->
                <div class="row mt-5" style="padding: 0 30px 0px 30px;">
                    <div class="col">
                    <h4>Rules and Regulations</h4>
                    <p><%- event_data[0].rules %></p>
                    </div>
                </div>

              </div>
            </div>
          </section>
          

        
      </div>
      <footer class="main-footer">
        <div class="footer-left">
          Copyright © 2025  <a href="#">Spectrum Sports </a> All rights reserved
        </div>
        <div class="footer-right">
        </div>
      </footer>
    </div>
  </div>

  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
  <script>
    document.getElementById("pay-btn").addEventListener("click", async function () {
      console.log("Creating Order...");
      const amount = document.getElementById("ammount").value;
      const event_type = document.getElementById("event_type").value;
      const event_name = document.getElementById("event_name").value;
      const event_id = document.getElementById("event_id").value;

  
      try {
        const response = await fetch("create-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ amount: amount * 100, currency: "INR" }), // ₹500
        });
  
        const order = await response.json();
        console.log("Order Created:", order);
  
        if (!order.id) {
          console.error("Order ID is missing. Check Backend API!");
          return;
        }
  
        var options = {
          key: "rzp_test_BUD9Yk5SbLIolX",
          amount: order.amount,
          currency: order.currency,
          name: "CISS",
          description: "Demo Test Transaction",
          order_id: order.id, // Ensure order ID is not undefined
          handler: async function (response) {
            console.log("Payment Successful:", response);
        
            // ✅ Merge response properties
            const updatedResponse = {
                ...response,
                event_name: event_name,
                event_type: event_type,
                event_id:event_id,
                amount: amount 
            };
        
            try {
                const verifyResponse = await fetch("verify-payment", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(updatedResponse),
                });
        
                const result = await verifyResponse.json();
                console.log("ttttttt Payment Verification Response:", result);
        
                if (result.status === "success") {
                    // ✅ Redirect to booking history page with query params (optional)
                    window.location.href = `/booking_pay`;
                } else {
                    alert("Payment verification failed. Please try again.");
                }
            } catch (error) {
                console.log("Error verifying payment:", error);
                alert("Something went wrong. Please try again.");
            }
        },
          theme: { color: "#3399cc" },
        };
  
        console.log("Razorpay Options:", options);
  
        var rzp = new Razorpay(options);
        rzp.open();
      } catch (error) {
        console.error("Error Creating Order:", error);
      }
    });
  </script>
  


  <!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
  document.getElementById("pay-btn").addEventListener("click", async function () {
    const response = await fetch("create-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount: 50000000, currency: "INR" }), // ₹500
    });

    const order = await response.json();

    var options = {
      key: "rzp_test_BUD9Yk5SbLIolX",
      amount: order.amount,
      currency: order.currency,
      name: "ciss",
      description: " demo Test Transaction",
      order_id: order.id,
      handler: async function (response) {
        console.log("Payment Successful:", response);
        const verifyResponse = await fetch("verify-payment", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(response),
        });

        const result = await verifyResponse.json();
        alert(result.message);
      },
      theme: { color: "#3399cc" },
    };

    var rzp = new Razorpay(options);
    rzp.open();
  });
</script> -->
  <!-- General JS Scripts -->
  <script src="/assets/js/app.min.js"></script>
  <!-- JS Libraies -->
  <script src="/assets/bundles/apexcharts/apexcharts.min.js"></script>
  <!-- Page Specific JS File -->
  <script src="/assets/js/page/index.js"></script>
  <!-- Template JS File -->
  <script src="/assets/js/scripts.js"></script>
  <!-- Custom JS File -->
  <script src="/assets/js/custom.js"></script>
<!-- CANVAS CHART JS  SCRIPT START  CANVAS CHART JS  SCRIPT START  CANVAS CHART JS  SCRIPT START  -->
<script>

readmore = true;


window.onload = function () {

 DATAPOINTS =  document.getElementById('dataPoints').value; 
 DATAPOINTS = JSON.parse(DATAPOINTS)

 clientIp =  document.getElementById('clientIp').value; 

 const timestamp = new Date().toString();
   LastLogin = `From IP- ${clientIp} on ${timestamp} `;

    var halfLength = Math.ceil(LastLogin.length / 4);

    document.getElementById('lastlogin').innerText  =  LastLogin.substring(0, halfLength);

   

var chart = new CanvasJS.Chart("chartContainer", {
  animationEnabled: true,
  theme: "light2", // "light1", "light2", "dark1", "dark2"
  title:{
    text: "Top Interested Properties"
  },
  axisY: {
    title: "Interest Count"
  },
  data: [{        
    type: "column",  
    showInLegend: true, 
    legendMarkerColor: "grey",
    legendText: "MyRentWish",
    dataPoints: DATAPOINTS
  }]
});
chart.render();

}




function toggleReadMore() {  
    var readMoreContent = document.getElementById('readMoreContent');

    // Toggle the display of the read more content
    if (readmore == true) { 
       lastlogin.style.display = 'inline';
       document.getElementById('lastlogin').innerText  =  LastLogin
       readmore = false; 

    } else {
      document.getElementById('lastlogin').innerText  =  LastLogin.substring(0, halfLength);  
      readmore = true;    
    }
  }
</script>
</body>


<!-- index  21 Nov 2019 03:47:04 GMT -->
</html>